<html>
<head>
<title>stomp-sampler</title>
</head>
<h1>stomp-sampler</h1>
<body>
<div><table>
{% for sample in samples %}
<tr>
<td><b>{{ loop.index }}) </b></td>
<td>{{ sample }}</td>
<td><button type="button" onclick="promptRename('{{sample}}')">Rename</button></td>
<td><audio controls><source src="{{ url_for('static', filename = sample)}}"></audio></td>
<td><button type="button" onclick="deleteSample('{{sample}}')">Delete</button></td>
</tr>
{% endfor %}
</table>
</div>
<br/><br/>

{% if max_samples%}
<i>reached limit ({{ samples|length }})</i>
<br/><br/>
{% endif %}

<form enctype="multipart/form-data" action="/sample" method="POST">
<p>Add a new sample:</p>
{% if max_samples %}
<input name="file" type="file" disabled/>
{% else %}
<input name="file" type="file"/>
{% endif %}
{% if max_samples %}
<input type="submit" disabled/>
{% else %}
<input type="submit"/>
{% endif %}
</form>

</body>
</html>

<script>
function deleteSample(sample) {
    var xhr = new XMLHttpRequest();
    let endpoint = "/sample/";
    let path = endpoint.concat(sample);
    
    xhr.onreadystatechange = function() {
        if (xhr.readyState == XMLHttpRequest.DONE) {
            location.reload()
        }
    }
    xhr.open("DELETE", path, true);
    xhr.send();
}

function promptRename(oldName) {
    let title = "Enter a new filename for ".concat(oldName).concat(" (including file extension).");
    newName = prompt(title, oldName);
    if (newName != null) {
        renameSample(oldName, newName);
    }
}

function renameSample(oldName, newName) {
    var xhr = new XMLHttpRequest();
    let endpoint = "/rename/";
    let path = endpoint.concat(oldName);
    let args = "?name=".concat(newName);
    let fullPath = path.concat(args);
    xhr.onreadystatechange = function() {
        if (xhr.readyState == XMLHttpRequest.DONE) {
            location.reload()
        }
    }
    xhr.open("POST", fullPath, true);
    xhr.send();
}
</script>